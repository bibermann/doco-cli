# Doco configuration

Doco uses the first `doco.config.toml` or `doco.config.json` file it finds,
beginning at the current working directory,
going upwards the directory hierarchy.

Environment variables can override the settings found in the configuration file.

All settings are optional, but for the `doco backups` command you need to set `.backup.rsync.host`.

## Configuration possibilities

Example configuration file
`doco.config.toml` ([TOML syntax](https://toml.io/en/)):
```toml
# $schema: ./doco.config-schema.json

[[output.text_substitutions.bind_mount_volume_path]]
pattern = "^/var/(.*)$"
replace = "[red]/var/\\1[/]"

[backup.structure]
uid = "1000"
gid = "1000"

[backup.restore_structure]
uid = "1000"
gid = "1000"

[backup.rsync]
host = "my-nas.example.com"
user = "backup-user"
module = "NetBackup"
root = "/docker-projects"
args = [
  "--rsh", "ssh -p 22 -i /home/johndoe/.ssh/id_ed25519",
]
```

Instead of `doco.config.toml` you may give a
`doco.config.json` (JSON syntax).

Example environment variables:
```bash
DOCO_BACKUP_STRUCTURE_UID="1000"
DOCO_BACKUP_STRUCTURE_GID="1000"
DOCO_BACKUP_RESTORE_STRUCTURE_UID="1000"
DOCO_BACKUP_RESTORE_STRUCTURE_GID="1000"

DOCO_BACKUP_RSYNC_HOST="my-nas.example.com"
DOCO_BACKUP_RSYNC_USER="backup-user"
DOCO_BACKUP_RSYNC_MODULE="NetBackup"
DOCO_BACKUP_RSYNC_ROOT="/docker-projects"
DOCO_BACKUP_RSYNC_ARGS="--rsh 'ssh -p 22 -i /home/johndoe/.ssh/id_ed25519'"
```

## Configuration details

### Output

In `.output.text_substitutions.bind_mount_volume_path`
you can define how you want to highlight _bind mounts_ depending on its source path.
In the example above, each mount point beginning with `/var/` is highlighted in red.
If this section appears more than once, all the rules are applied in order.

More information:
- For the regular expression syntax, see https://docs.python.org/3/library/re.html.
- For the text formatting syntax, see https://rich.readthedocs.io/en/stable/markup.html.
- For a list of supported colors, see https://rich.readthedocs.io/en/stable/appendix/colors.html.

### Backup

If you specify `.backup.structure.uid` or `.backup.structure.gid`,
the ownership of additional directories and configuration files generated by doco
will be changed to the given UID/GID.

If you specify `.backup.restore_structure.uid` or `.backup.restore_structure.gid`,
the ownership of directories that need to be created before restoring
(to match the original locations of the backed up files)
will be changed to the given UID/GID.

UID and GID can be given as numbers or names.
Names are translated on the machine running doco.

For information on how to use rsync-daemon features via a remote-shell connection, see:
- https://download.samba.org/pub/rsync/rsync.1#opt--rsh
- https://download.samba.org/pub/rsync/rsync.1#USING_RSYNC-DAEMON_FEATURES_VIA_A_REMOTE-SHELL_CONNECTION

### Configuration schema

Run `doco --create-schema` to create the `doco.config-schema.json` file.
